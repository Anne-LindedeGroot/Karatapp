#!/bin/bash

# ðŸš€ FLUTTER-FAST - Smart Flutter Command Wrapper
# Automatically uses fast run for 'flutter run' command

# Prevent infinite loops - check if we're already in fast mode
if [ "$FLUTTER_FAST_ACTIVE" = "1" ]; then
    # Already in fast mode, use original flutter
    exec /Users/anne-lindedegroot/flutter/bin/flutter.original "$@"
fi

# Find the project directory by looking for pubspec.yaml
find_project_root() {
    local dir="$(pwd)"
    while [ "$dir" != "/" ]; do
        if [ -f "$dir/pubspec.yaml" ]; then
            echo "$dir"
            return 0
        fi
        dir="$(dirname "$dir")"
    done
    return 1
}

# Check if this is a 'run' command
if [ "$1" = "run" ]; then
    # Find project root
    PROJECT_ROOT=$(find_project_root)
    if [ $? -eq 0 ] && [ -f "$PROJECT_ROOT/fast_run.sh" ]; then
        # Use the fast run script instead
        shift  # Remove 'run' from arguments
        cd "$PROJECT_ROOT"
        # Set flag to prevent loops and execute fast script
        export FLUTTER_FAST_ACTIVE=1
        exec "$PROJECT_ROOT/fast_run.sh" "$@"
    else
        # Fallback to original flutter if fast script not found
        exec /Users/anne-lindedegroot/flutter/bin/flutter.original "$@"
    fi
else
    # For all other flutter commands, use regular flutter
    exec /Users/anne-lindedegroot/flutter/bin/flutter.original "$@"
fi
